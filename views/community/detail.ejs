<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>WISE market - <%= title %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="header-top">
        <a href="/" class="logo">WISE market</a>
        <div class="header-right">
          <% if (currentUser) { %>
            <span class="welcome"><%= currentUser.nickname %> 님</span>
            <form action="/auth/logout" method="post" class="logout-form">
              <button type="submit" class="link-button">로그아웃</button>
            </form>
          <% } else { %>
            <a href="/auth/login" class="auth-link">로그인</a>
            <span class="divider">|</span>
            <a href="/auth/signup" class="auth-link">회원가입</a>
          <% } %>
        </div>
      </div>
      <div class="header-bottom">
        <nav class="nav-main">


          <% if (currentUser) { %>
       

          <% } %>
        </nav>
      </div>
    </div>
  </header>

  <div class="container mt-3">
    <!-- 제목 + 목록으로 버튼 -->
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2 class="mb-0"><%= post.title %></h2>
      <a href="/community/<%= board.board_id %>" class="btn btn-primary btn-action">
        목록으로
      </a>
    </div>

    <p class="text-muted">
      작성자 <strong><%= post.author_nickname %></strong> ·
      <%= new Date(post.created_at).toLocaleString("ko-KR", {
        year: "numeric",
        month: "2-digit",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit",
      }) %>
    </p>

    <% if (post.image_path) { %>
      <div class="mb-3">
        <img
          src="<%= post.image_path %>"
          alt="게시글 이미지"
          style="max-width: 600px; width: 100%; border-radius: 10px; object-fit: cover;"
        />
      </div>
    <% } %>

    <div class="mb-4" style="white-space: pre-line;">
      <%= post.content %>
    </div>

    <% if (currentUser && currentUser.user_id === post.author_id) { %>
      <div class="mb-4">
        <a
          href="/community/<%= board.board_id %>/<%= post.post_id %>/edit"
          class="btn btn-primary btn-action me-2"
        >
          글 수정
        </a>
        <form
          action="/community/<%= board.board_id %>/<%= post.post_id %>/delete"
          method="post"
          style="display:inline-block;"
          onsubmit="return confirm('정말 삭제하시겠습니까?');"
        >
          <button type="submit" class="btn btn-danger btn-action">
            글 삭제
          </button>
        </form>
      </div>
    <% } %>

    <hr />

    <h4>댓글</h4>

    <% if (comments.length === 0) { %>
      <p class="text-muted">아직 댓글이 없습니다.</p>
    <% } else { %>
      <ul class="list-group mb-3">
        <% comments.forEach(function(comment) { %>
          <li class="list-group-item">
            <p style="margin-bottom: 4px;">
              <strong><%= comment.author_nickname %></strong>
              <span class="text-muted" style="font-size: 12px;">
                ·
                <%= new Date(comment.created_at).toLocaleString("ko-KR", {
                  year: "numeric",
                  month: "2-digit",
                  day: "2-digit",
                  hour: "2-digit",
                  minute: "2-digit",
                }) %>
              </span>
            </p>
            <p style="margin-bottom: 4px;"><%= comment.content %></p>

            <% if (currentUser && currentUser.user_id === comment.author_id) { %>
              <form
                action="/community/<%= board.board_id %>/<%= post.post_id %>/comments/<%= comment.comment_id %>/delete"
                method="post"
                onsubmit="return confirm('댓글을 삭제하시겠습니까?');"
              >
                <button type="submit" class="btn btn-sm btn-outline-danger">
                  삭제
                </button>
              </form>
            <% } %>
          </li>
        <% }); %>
      </ul>
    <% } %>

    <% if (currentUser) { %>
      <form
        action="/community/<%= board.board_id %>/<%= post.post_id %>/comments"
        method="post"
      >
        <div class="mb-3">
          <label class="form-label" for="commentContent">댓글 작성</label>
          <textarea
            id="commentContent"
            name="content"
            class="form-control"
            rows="3"
            required
          ></textarea>
        </div>
        <button type="submit" class="btn btn-primary btn-action">
          댓글 등록
        </button>
      </form>
    <% } else { %>
      <p class="text-muted">
        댓글을 작성하려면 <a href="/auth/login">로그인</a>하세요.
      </p>
    <% } %>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <%- include("../partials/bottom-nav") %>
</body>
</html>
