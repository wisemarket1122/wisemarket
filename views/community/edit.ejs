<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>WISE market - <%= title %></title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="/css/style.css" />
</head>
<body>
  <header>
    <div class="header-inner">
      <div class="header-top">
        <a href="/" class="logo">WISE market</a>
        <div class="header-right">
          <% if (currentUser) { %>
            <span class="welcome"><%= currentUser.nickname %> 님</span>
            <form action="/auth/logout" method="post" class="logout-form">
              <button type="submit" class="link-button">로그아웃</button>
            </form>
          <% } else { %>
            <a href="/auth/login" class="auth-link">로그인</a>
            <span class="divider">|</span>
            <a href="/auth/signup" class="auth-link">회원가입</a>
          <% } %>
        </div>
      </div>
      <div class="header-bottom">
        <nav class="nav-main">


          <% if (currentUser) { %>
            

          <% } %>
        </nav>
      </div>
    </div>
  </header>

  <div class="container mt-3">
    <!-- 제목 + 글 보기 버튼 (오른쪽, 안 겹치도록 flex-wrap) -->
    <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
      <h2 class="mb-0"><%= board.name %> 글 수정</h2>
      <div>
        <span
          class="d-inline-block"
          tabindex="0"
          data-bs-toggle="popover"
          data-bs-trigger="hover focus"
          data-bs-content="수정 중인 글 상세 보기로 이동합니다."
        >
          <a
            href="/community/<%= board.board_id %>/<%= post.post_id %>"
            class="btn btn-primary btn-action"
          >
            글 보기
          </a>
        </span>
      </div>
    </div>

    <% if (error) { %>
      <p style="color:red;"><%= error %></p>
    <% } %>

    <form
      action="/community/<%= board.board_id %>/<%= post.post_id %>/edit"
      method="post"
      enctype="multipart/form-data"
    >
      <div class="mb-3">
        <label class="form-label" for="title">제목</label>
        <input
          type="text"
          id="title"
          name="title"
          class="form-control"
          value="<%= post.title %>"
          required
        />
      </div>

      <div class="mb-3">
        <label class="form-label" for="content">내용</label>
        <textarea
          id="content"
          name="content"
          class="form-control"
          rows="8"
          required
        ><%= post.content %></textarea>
      </div>

      <% if (post.image_path) { %>
        <div class="mb-3">
          <p>현재 게시글 이미지:</p>
          <img
            src="<%= post.image_path %>"
            alt="게시글 이미지"
            style="max-width:300px; border-radius:8px;"
          />
        </div>
      <% } %>

      <div class="mb-4">
        <label class="form-label" for="image">새 이미지로 교체 (선택)</label>
        <input
          type="file"
          id="image"
          name="image"
          class="form-control"
          accept="image/*"
        />
        <small class="text-muted">
          새 이미지를 선택하지 않으면 기존 이미지가 유지됩니다.
        </small>
      </div>

      <div class="mt-3">
        <span
          class="d-inline-block"
          tabindex="0"
          data-bs-toggle="popover"
          data-bs-trigger="hover focus"
          data-bs-content="수정한 내용을 저장합니다."
        >
          <button type="submit" class="btn btn-primary btn-action">
            수정 완료
          </button>
        </span>
      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const popoverTriggerList = document.querySelectorAll('[data-bs-toggle="popover"]');
    popoverTriggerList.forEach(el => {
      new bootstrap.Popover(el);
    });
  </script>
  <%- include("../partials/bottom-nav") %>
</body>
</html>
